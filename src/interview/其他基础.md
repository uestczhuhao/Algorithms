### 读扩散和写扩散
#### 写扩散(Push)
该方式为每个用户维护一个订阅列表，记录该用户订阅的消息索引（一般为消息ID、类型、发表时间等一些元数据）。每当用户发布消息时，都会去更新其follower的订阅列表。
优点：读很轻。初始化时仅需要读取自己的inbox即可。
缺点：写很重。每发布一个消息，会导致大量的写操作。
注：一般来说，用户发布消息，并不会更新所有followers的订阅列表，仅更新在线followers即可。

#### 读扩散(Pull)
该方式为每个用户维护一个发送列表，记录该用户所有发表过的消息索引。
优点：写很轻，节省空间。用户每发布一条消息，仅需更新自己的outbox。
缺点：读操作很重，计算量大。假设你收听了1k用户，则初始化时，需要从1k个用户的outbox拉取消息，然后计算获得最新的n条消息。

#### 混合模式(Push+Pull)
该方式既为读写扩散的结合，根据用户followers的数量来决定是读扩散还是写扩散。例如followers大于1k的，则使用读扩散，否则使用写扩散。

### TPS、RPS和QPS的区别
- TPS：Transactions Per Second（每秒传输的事物处理个数），即服务器每秒处理的事务数。一个事务是指一个客户机向服务器发送请求然后服务器做出反应的过程。客户机在发送请时开始计时，收到服务器响应后结束计时，以此来计算使用的时间和完成的事务个数。
- QPS：Queries Per Second意思是“每秒查询率”，是一台服务器每秒能够响应的查询次数，是对一个特定的查询服务器在规定时间内所处理流量多少的衡量标准。
- 如果是容量场景，假设n个接口都是查询接口，且这个接口内部不会再去请求其它接口，qps=n*tps
- RPS 代表吞吐率，即 Requests Per Second，指的是某个并发用户数下单位时间内处理的请求数，等效于QPS

### 存储IP地址，用什么数据类型比较好？

### 微服务传输traceId，放在哪里？
- 一般放在HTTP的请求头里

### 怎么预防CSRF？
用csrf防止cookie被盗用，


### 给定m个不重复字符[a,b,c]，以及一个长度为n的字符串，问是否能在这个字符串中找到一个长度为m的连续子串，要求子串由m个字符组成，顺序不要求
- TODO

## 操作系统
- 1000个并发线程，10台机器，每个4核，设计线程池大小
- 操作系统IO模型
- IO多路复用
- 线程和进程区别
- 生产者消费者模型
- 内存分配算法
- 页结构
- linux是如何启动的
- 分布式事物和共识算法
- 主线程的上下文如何传递给子线程
- CPU的缓存一致性协议（MESI）是什么？和Java的volatile关键字的区别和联系
  - 前者保证了多核处理器之间的缓存一致性，但不能解决线程间的可见性和指令重排问题（死锁、数据竞争）
  - 后者刚好是解决这些问题。因此二者的场景不同
- 并发和并行的区别
- 进程调度策略有哪些
-
### 零拷贝
1. mmap内存映射，比普通的read调用节省从内核缓冲区到用户空间缓冲区的拷贝
2. sendfile（linux 2.1引入）将文件传递到套接字上（反过来不行），其实现为将带有文件位置和长度信息的缓冲区描述符添加socket缓冲区去，这一步不会将内核中的数据拷贝到socket缓冲区中
3. 非零拷贝
   - 数据从网卡过来，需要给CPU处理，那么需要给到内存
   - 而内存分为用户态和内核态，CPU处理数据要到内核态
   - 所以网卡的数据要在内存中搬2次到内核态
   - 零拷贝是只提供一次就搬到内存里给CPU了



## 计算机网络
- http和https区别
- http状态码，2xx和3xx分别是什么状态
- 返回500、502和504的区别A
- 线上500如何排查
- 三次握手，四次挥手
- 为什么会有close-wait
- 从输入url到页面加载完毕过程，DNS寻址
- tcp如何实现拥塞控制
- 粘包和丢包？具体是怎么实现的
- http post的两次发送


## Zookeeper
- 发布订阅功能是什么？一般用做什么场景？是怎么实现的？
  - 对节点监听，节点的数据发生变化，客户端会收到通知（可以多个订阅者订阅一个主题），但不适合大规模的消息
- 一般用zk干啥
  - 分布式锁、命名服务（存储分布式服务的配置信息、元数据等）、配置管理（变更时通知系统）、分布式队列、分布式协调（选主、成员管理等）、高可用性（节点故障时自动选主）
- zk属于AP、CP还是CA？
  - CP，是如何保证的？
- Raft算法的领导选举过程？工作原理是啥？
- zk的watch机制？是怎么实现的？
- 命令、配置和管理是如何实现的

## Kafka
- 如何防止脑裂
  - 副本机制
    - 每个分区多副本，一个副本被选为主（处理读写请求），出故障时选举新的主
  - 心跳机制
    - 通过心跳检测副本的存在，否则标记为离线，以及时发现和处理故障副本
  - zk的协调（新版本用了kRaft）
    - 通过zk选举控制器的领导者
- kafka如何解决消息丢失？有哪些情况？分别怎么处理？
- kafka如何保证不重复消费（只消费一次）
- kafka如何保证消费的顺序
- 零拷贝是怎么实现的
- 简述kafka的架构设计
- 消息被顺序生产，顺序消费，但不同进程的消费速度不一致，如何保证顺序？
- 持久化内存满了怎么办？只能迁移吗？
- kafka和rocket MQ、rabbitMQ的区别
- kafka的数据是存储在哪里的？
  - 硬盘里，突出顺序读

## ES
- 数百T的数据放在ES中，涉及聚合操作，怎么实时显示？
  - 区分出冷热数据，看热数据是否能做到实时显示
  - 相对固化的需求做预聚合（如flink），再做最终聚合
  - 相对灵活的需求，可以采用OLAP引擎来做
    - 低qps，高延迟的场景：presto/imapla，hive/spark都可
    - QPS高，时延低：flink预计算后，存入HBase，查询时对最终结果进行逻辑聚合处理
      - 缺点是链路比较长

## 真题：有10个消费节点，突然某几个在凌晨宕机了，早上发现有大量消息堆积，如何在不发布代码且不扩容的情况下，快速解决堆积的问题
- 消费线程是否可以配置更大的值
- 摘掉外部流量，全部用来消费消息
- 看消息是否能跳过
  - 如果能，直接跳过，事后回溯（有助于业务快速恢复，如银行业务）
  - 如果不能，分区数多于机器数时，可以加机器；反之加分区数量
- 消息消费的影响因素：吞吐，即并发和单消息处理速度，后者很难改变，只能变前者；加消费线程数


## 设计模式
- 观察者模式中，观察者很多，第一个和最后一个Observer时间间隔很长
  - 耗时在ack上，考虑异步IO

## Netty是干啥的？原理是什么？

### 线上服务CPU负载高，怎么排查
- top找到占用CPU最高的线程
- jstack查看线程堆栈，找到对应的线程信息
- 定位到线程池，分析代码
- 注意1：jstack可能会把线上打挂，因此业务量不大或测试环境复现时分析
- 注意2：jstack用的是十六进制，top是十进制，因此需要转换
- 实际：查两次代码diff或重启就能解决大部分问题

### 查询接口调优，不能用缓存，要求实时性，怎么办？
- 优化查询语句和数据库的配置，以提高查询效率
- 考虑使用异步处理来优化耗时操作
- 如果需要跨库查询多个服务，可以考虑使用分布式事务来保证数据的一致性[https://blog.csdn.net/YYQ_QYY/article/details/105996347]

### 线程池核心线程数20，最大600，阻塞队列200，当qps为200时，请求（调用第三方，一个长时间的任务）阻塞超时，请问如何提高吞吐量
- 使用更高效的线程池实现，如ForkJoinPool
- 将长时间任务拆分为多个小任务，并行执行
- 使用异步非阻塞的方式处理第三方调用，避免阻塞线程池

### 滑动窗口限流怎么做？
- 可以采用一个固定大小的时间窗口统计请求的数量
- 如果请求超过了设定的阈值，则进行限流处理
- 实现：采用双端队列实现，每次新的请求来时，过期的请求移除，并判断当前队列中的请求是否超过阈值

#### 桥能承重600kg，现在有700kg的牛，怎么过河（系统承载600qps，700qps怎么办）
- 能不能把700qps打平，分次过（牛宰了分次过）
- 只服务其中的600qps，其他的拒绝（牛饿瘦了过）
- 用别的服务顶一下（临时找船过）
- 加机器解决（加固桥，能承重更多）
- 重构优化项目（重新造一个新桥）

#### Bloom Filter原理

### 10亿个key中如何判断某个key是否存在？
要求：内存空间不能太大；500w查询流量qps
- redis的bitmap实现，通过key hash下标位置
  - 不能解决hash冲突的问题
- hash 后布隆过滤器能判断一定不存在，但无法判断是否存在
- ART前缀树？？？

### 真题：限流，1分钟处理1000个请求
- 单线程
- 多线程
- 

### https的原理？对称加密和非对称加密（RSA、AES和证书的原理）

### 场景题：数据量很大的情况下，需要先从db获取用户基础信息，然后根据用户基本信息查询redis中关联的信息，如何提高性能？（忽略OOM）

### 场景题：Mysql的InnoDb和MyISAM引擎，使用自增主键，突然断电后重启，自增主键会连续吗？为什么

### 10g数据，2g内存，如何去重？

### 几十万QPS的全局唯一分号器
- 雪花算法（核心是提前生成好一批存起来，用的时候直接取）

### 大文件，求出其出现频率TOPK的词
- 分治思想，先把大文件分到5000（比如）个小文件里（比如hash）
- 对每个小文件求出TOPK词频
- 再归并排序


## 算法题
- 加油站
- k个一组翻转单链表
- 二叉树第k层偶数和
- 判断一个数组数据是否是二叉搜索树的后续遍历
- 单例模式，
- 两个list的区间交集
- 二叉树锯齿形层次遍历
- 字典序的第k小数字
- 二叉树以中序遍历方式转换成双向链表，空间O(1)
- 给定一个n*m的数组，每个位置一个分数，求左上到右下的最大分数
- 将一个无序数组插入1g个元素的有序数组中
- 对一个100g的文件去重
- 可怜的小猪
- 盛最多水的容器
- 174地下城游戏
- 二叉树中序遍历
- 中文字符转化为数字（五百三十万六千零三 -> 5306003），输入在一亿之内
- 二维数组，行递增，列也递增，能否找到某个数
- 最长回文子串
- 快排的基本思想，时间和空间复杂度？
- 归并排序的应用场景，时间和空间复杂度？
- 编辑距离
- 字符串a和b相减的结果
- 最小覆盖子串 76
- 删除排序链表中的重复元素II 82
- 返回第N行的格雷码
