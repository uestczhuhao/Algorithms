## 美团
### 治理分析项目
- Mysql
  - 提前聚合已知维度，可扩展性不高
    - 租户（100个）-治理项（15个）- 时间（365天）
    - 用户（1.6w）- 治理项（15个）- 时间（365天）
- ES
  - 增加组织架构维度（4000），不能提前聚合
  - 存放明细数据（600w + 每天5w增量），取治理状态为缓慢变化维，以开始-结束时间为拉链，做拉链表
    - 事后证明除了缓慢变化维，其余字段也会发生变化，如待治理量，业务归属等
- Doris（向量化计算）
  - 存放所有明细数据，所有维度现场聚合计算（需要秒级内返回）

- 组织架构展示
  - 无限级N叉树结构
  - 拓补排序（BFS）

### 智能治理规则
- easy-rules引擎
- 

### 资产管理平台
- SpiffWorkflow框架
- Celery框架
  - 采用带哨兵模式的主从模式的Redis充当Celery的Broker角色
- 降幅本需求中，采用redis充当fd的分布式锁以控制并发

### 数据同步平台
- lambda 架构实现元数据同步
- databus+Kafka+实时同步服务


### 一些辅助信息
#### 治理诉求（分角色）
- 角色：业务负责人
- 核心诉求： 
  - 成本流向，钱（成本）花在哪（哪个项目or哪个业务目标），花的值不值 
  - 治理目标怎么定，投多少人能拿多少收益

- 角色：管治接口人
- 核心诉求： 
  - 预算填报高效且合理，资源分配、使用高效且便捷 
  - BG/核算单元粒度的预算->使用->成本的一站式分析诉求 
  - 成本发生前的成本管治以及成本发生后的评估->问题分配->治理跟进->效果分析的一站式治理诉求 
  - 除成本外，对于规范、质量、安全等也有管治诉求

- 角色：预算review专家组
- 核心诉求： 
  - 核算单元、租户、资源等维度的预算、交付、使用等分析以及洞察能力 
  - 清晰的预算展示形式以及review评价能力、review后的建议执行跟进

- 角色：数据RD
- 核心诉求： 
  - 分配的治理问题归属正确、判定正确，有行之有效且高效的治理措施，治理后能立即给出反馈（治理成功or失败）


#### 治理项：
1. 存储 
- 无效存储指标：90天前创建，且最近90天内无应用层访问热度的表（包含该表及下游表） 
- 生命周期配置不合理指标：生产表中未配置生命周期的分区表 
- 存储选型不合理指标：未采用合理的存储格式（ORC）；比如采用text格式进行存储 
- 冷数据：对于有长时间保存需求的重要数据，且使用频次极低（小于2次/年） 
- 表冗余：生产全量表的同时，使用同样的参数生产了快照

2. 计算（spark参数调整）
- 无效任务：生产出的表超过90天，且最近90天内无应用层访问热度的表 
- 低内存利用率：近30天spark作业内存利用率平均值低于60% 
- 高失败率任务：数仓生产任务中，最近30次调度内，每7个调度内至少有一次调度失败 
- 暴力扫描：扫描分区大于90天，二级以上分区汇总到一级天分区；扫描平均每分区大小大于500M或者总分区大小大于100G 
- 产出持续一致任务：最近15天任务产出数据相同
- 无效dashboard：最后访问日期在180天前，且注册了调度的魔数dashboard

3. 实时Flink任务
- 无效Flink任务：任务和递归下游任务未写入Tair且关联Topic无下游消费
- 无输入flink任务：Flink任务中所有算子的输入数据量持续30天为空的任务
- 低资源利用率flink任务：任务的近30天CPU利用率峰值或内存利用率峰值低于65%
- 并发配置不合理：max(source/sink)的并发 > RT页面配置的并发
- 无状态任务：flink任务的checkpoint 状态大小 < 1M
- checkpoint耗时短延任务：一周内CheckPoint最大耗时<10s


4. Kafka Topic：
- 无效Kafka topic：近30天内，topic输出流量为0
- 低输出Kafka topic：近30天内，topic输出流量/输入流量<0.01

#### 元数据需求
- 表：热度，血缘，基础（生命周期，存储格式）
- 任务：内存使用，失败率
- flink作业：内存利用
- kafka topic：输出的信息的topic信息

#### 治理相关
- 治理手段：删表、删分区、配置生命周期、转orc压缩，转冷存、改任务配置参数（如spark任务）

- 链路：资产分析（发现问题，制定目标） -> 资产评估（筛选问题资产，分配治理任务） -> 治理动作（自动规则，运动式治理） -> 治理收益

- 事前：基于检查项阻断上线/资源参数推荐    事中： 业务参数进行调优（基于历史，HBO比较通用）     事后：通用治理项以及业务自定义治理项


## 小米

###
